{% extends "base.html" %}
{% load static %}
{% block title %}Admin Dashboard{% endblock %}
{% block extra_scripts %}
    <script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}
{% block content %}
<div class="card">
    <h2>Admin Dashboard</h2>
    <p>Pending Bookings: {{ pending_bookings }}</p>
    <h3>Upload Timetable</h3>
    <form id="uploadForm" method="post" enctype="multipart/form-data" action="{% url 'admin_dashboard:upload-timetable' %}" class="space-y-4">
        {% csrf_token %}
        <div class="dropzone">Drag and drop a CSV/Excel file here or click to browse</div>
        <input type="file" name="file" id="fileInput" accept=".csv,.xlsx" class="hidden">
        <button type="submit" class="btn btn-primary w-full">Upload</button>
    </form>
    <h3>Timetable</h3>
    <div id="timetableLoading">Loading...</div>
    <table id="timetableTable" style="display: none;">
        <thead>
            <tr>
                <th>Day</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Classroom</th>
                <th>Teacher</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <button onclick="exportCSV()" class="btn btn-secondary mt-4">Export Timetable as CSV</button>
    <h3>Usage Statistics</h3>
    <canvas id="usageChart"></canvas>
    <h3>Peak Hours</h3>
    <canvas id="peakHoursChart"></canvas>
    <h3>Active Faculty</h3>
    <canvas id="activeFacultyChart"></canvas>
    <h3>Bookings</h3>
    <div id="bookingLoading">Loading...</div>
    <table id="bookingTable" style="display: none;">
        <thead>
            <tr>
                <th>User</th>
                <th>Classroom</th>
                <th>Date</th>
                <th>Time</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    <h3>Upcoming Events</h3>
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Visibility</th>
            </tr>
        </thead>
        <tbody>
            {% for event in upcoming_events %}
                <tr>
                    <td>{{ event.title }}</td>
                    <td>{{ event.start_date|date:"Y-m-d H:i" }}</td>
                    <td>{{ event.end_date|date:"Y-m-d H:i" }}</td>
                    <td>{{ event.visibility }}</td>
                </tr>
            {% empty %}
                <tr><td colspan="4">No upcoming events.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
